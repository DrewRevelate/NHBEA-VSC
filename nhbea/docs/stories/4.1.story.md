# Story 4.1: Foundation CSS System & Design Tokens

## Status
done

## Story
**As a** Front-end Developer,
**I want** to implement the core CSS custom properties, design tokens, and foundational styling system,
**so that** we have a consistent, maintainable foundation for the conservative royal blue brand transformation.

## Acceptance Criteria
1. The complete conservative royal blue color palette (#2563eb primary) is implemented as CSS custom properties following the 60-30-10 color rule
2. A comprehensive design token system is established including colors, spacing, shadows, borders, and animation tokens
3. The CSS custom properties architecture supports both light and dark mode implementations
4. All design tokens are responsive and include breakpoint-specific adjustments for mobile devices
5. The foundational styling system is documented and ready for component implementation
6. Brand-consistent spacing scale, shadow system, and border radius tokens are implemented
7. All CSS custom properties follow semantic naming conventions for maintainability
8. The system supports the full brand color variations including accent colors (warm orange, academic gold, forest green)

## Tasks / Subtasks
- [x] Implement conservative royal blue color palette (AC: 1, 8)
  - [x] Replace existing navy/gold color variables with royal blue (#2563eb) primary color system
  - [x] Implement royal blue variations (dark, deeper, light, lighter, subtle) as defined in brand spec
  - [x] Add warm orange accent color (#ea580c) with variations for high-priority CTAs
  - [x] Add academic gold accent color (#fbbf24) with variations for awards/achievements
  - [x] Add forest green accent color (#059669) with variations for progress/success states
  - [x] Implement neutral gray palette (gray-50 through gray-900) for layout foundation
  - [x] Add status colors (success, warning, error, info) with background variants
- [x] Establish comprehensive design token architecture (AC: 2, 7)
  - [x] Create semantic color tokens that map to brand colors (brand-primary, brand-accent-primary, etc.)
  - [x] Implement component-specific tokens (button-primary-bg, card-bg, input-border, etc.)
  - [x] Create spacing scale tokens (space-xs through space-6xl) replacing current spacing system
  - [x] Add border radius scale tokens (radius-sm through radius-full)
  - [x] Implement shadow scale with brand-specific shadows (shadow-brand, shadow-accent)
  - [x] Create animation tokens (duration-fast, ease-standard, etc.)
- [x] Implement responsive design token system (AC: 4)
  - [x] Add breakpoint-specific design token adjustments for mobile (max-width: 768px)
  - [x] Add breakpoint-specific adjustments for small screens (max-width: 480px)
  - [x] Ensure typography tokens scale appropriately across breakpoints
  - [x] Implement responsive spacing adjustments for mobile layouts
- [x] Add dark mode support architecture (AC: 3)
  - [x] Implement dark mode color adjustments using @media (prefers-color-scheme: dark)
  - [x] Maintain brand identity recognition in dark mode with adjusted royal blue tones
  - [x] Ensure proper contrast ratios for accessibility in both light and dark modes
  - [x] Test dark mode implementation across all design tokens
- [x] Create foundational CSS custom properties structure (AC: 5, 6)
  - [x] Replace existing :root color variables with new conservative royal blue system
  - [x] Update existing component classes (.nhbea-button-primary, .nhbea-card, etc.) to use new tokens
  - [x] Ensure backward compatibility during transition period
  - [x] Implement new brand-consistent component utility classes
- [x] Document the design token system (AC: 5)
  - [x] Create inline CSS comments explaining token usage and relationships
  - [x] Document the 60-30-10 color rule implementation in CSS comments
  - [x] Add usage examples for semantic vs component tokens
  - [x] Document responsive behavior and dark mode considerations
- [x] Update components with hardcoded colors to use design tokens (AC: 1, 5)
  - [x] Fix AboutHeroSection hardcoded navy/gold colors
  - [x] Audit all components for hardcoded color values
  - [x] Replace inline styles with CSS custom property references
  - [x] Test visual consistency across all pages

## Dev Notes

### Previous Story Context
Building upon the completed Stories 1.1-3.4 which established:
- **Next.js Foundation**: App Router, TypeScript, Tailwind CSS with ShadCN/ui components
- **Current Theme System**: Navy/gold academic theme in `/src/app/globals.css` with existing CSS custom properties
- **Component Architecture**: Established `.nhbea-*` component classes and utility patterns
- **Responsive Design**: Mobile-first approach with existing breakpoint considerations
- **Performance Patterns**: Optimized CSS with proper layer structure and reduced motion support

### Technical Architecture Requirements
[Source: docs/architecture/architecture-style.md, docs/architecture/core-backend-components.md]
- **Frontend Framework**: Next.js 14+ with App Router (established)
- **Styling System**: Tailwind CSS with custom CSS variables in `/src/app/globals.css`
- **Build Process**: Static export compatible (no dynamic CSS generation)
- **Performance Requirements**: Maintain <3 second initial load times
- **Accessibility Standards**: WCAG 2.1 AA compliance must be maintained

### Brand System Architecture
[Source: docs/front-end-spec/brand/1-complete-brand-color-system.md, docs/front-end-spec/brand/7-digital-implementation.md]

**Primary Color System (60% usage)**:
```css
--nhbea-royal-blue: #2563eb;          /* Main brand blue */
--nhbea-royal-blue-dark: #1e40af;     /* Headers, emphasis */
--nhbea-royal-blue-deeper: #1e3a8a;   /* Maximum authority elements */
--nhbea-royal-blue-light: #3b82f6;    /* Links, secondary elements */
--nhbea-royal-blue-lighter: #60a5fa;  /* Backgrounds, success states */
--nhbea-royal-blue-subtle: #93c5fd;   /* Subtle highlights */
```

**Accent Colors (10% usage)**:
```css
--nhbea-accent-orange: #ea580c;        /* Primary CTA accent */
--nhbea-accent-gold: #fbbf24;          /* Achievement highlights */
--nhbea-accent-green: #059669;         /* Progress, growth */
```

**Design Token Architecture Pattern**:
```css
/* Brand Level */
--brand-primary: var(--nhbea-royal-blue);
/* Semantic Level */
--color-text-primary: var(--nhbea-gray-800);
/* Component Level */
--button-primary-bg: var(--brand-primary);
```

### File Structure and Implementation Location
[Source: existing codebase analysis]
- **Primary File**: `/src/app/globals.css` - Contains all CSS custom properties and design tokens
- **Current Structure**: Uses `@layer base` for custom properties, `@layer components` for utilities
- **Integration Pattern**: Tailwind CSS integration with CSS custom properties
- **Existing Classes**: Extend/update `.nhbea-*` component classes to use new token system

### Current System Analysis
The existing `/src/app/globals.css` currently implements:
- Navy/gold color scheme that needs complete replacement
- Existing CSS custom property structure that can be extended
- Component utility classes (`.nhbea-card`, `.nhbea-button-primary`, etc.) that need token updates
- Proper layer architecture (`@layer base`, `@layer components`) to maintain
- Responsive typography and spacing systems to preserve and enhance

### Design Token Implementation Strategy
**Phase 1**: Replace color variables in `:root` selector
**Phase 2**: Update semantic color mappings
**Phase 3**: Update component-specific tokens
**Phase 4**: Add responsive breakpoint adjustments
**Phase 5**: Implement dark mode token overrides

### Accessibility and Performance Requirements
- **Color Contrast**: All new color combinations must meet WCAG 2.1 AA standards (4.5:1 for normal text, 3:1 for large text)
- **Reduced Motion**: Maintain existing `@media (prefers-reduced-motion: reduce)` support
- **Performance**: No impact on CSS bundle size; token system should not add significant build overhead
- **Browser Support**: Must work in all modern browsers; CSS custom properties have full support

### Integration with Existing Components
**Maintain Compatibility**: All existing `.nhbea-*` component classes must continue working
**Update Strategy**: Gradually update component tokens to use new brand colors
**Testing Requirements**: Visual regression testing to ensure no component breakage

## Testing

**Test File Locations**: Co-located test files are not applicable for CSS; testing will be through component integration tests
**Test Standards**: Visual testing and accessibility testing using existing Jest/React Testing Library setup

**Testing Frameworks**: 
- Lighthouse for accessibility and performance validation
- Manual visual testing across breakpoints
- Color contrast validation tools
- Cross-browser compatibility testing

**Specific Testing Requirements**:
- Verify all new CSS custom properties render correctly in components
- Test responsive behavior of design tokens across mobile/desktop breakpoints
- Validate dark mode implementation preserves brand identity and accessibility
- Test color contrast ratios for all text on background combinations
- Verify animation tokens work with reduced motion preferences
- Test component utility class updates don't break existing layouts
- Performance testing to ensure CSS changes don't impact load times
- Cross-browser testing for CSS custom property support

**Accessibility Testing Thresholds**:
- Color Contrast Ratio: ≥ 4.5:1 for normal text, ≥ 3:1 for large text
- Lighthouse Accessibility Score: ≥ 95
- Dark mode must maintain same accessibility standards
- All interactive elements must have proper focus indicators

**Performance Testing Thresholds**:
- CSS bundle size increase: < 10KB
- Lighthouse Performance Score: > 90 (maintain existing)
- First Contentful Paint: < 2.5s (maintain existing)
- No impact on existing responsive behavior

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-29 | 1.0 | Initial story creation for conservative royal blue brand foundation | SM Agent |
| 2025-07-29 | 1.1 | Complete implementation of royal blue design token system | Dev Agent (James) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Completion Notes
- ✅ Successfully implemented complete conservative royal blue brand transformation
- ✅ All color tokens replaced navy/gold with royal blue system following 60-30-10 rule  
- ✅ Three-layer token architecture established (Brand → Semantic → Component)
- ✅ Dark mode maintains brand identity with proper contrast ratios
- ✅ Responsive system adjusts tokens for mobile/small screen optimization
- ✅ Build process validates without errors - no CSS compilation issues
- ✅ Comprehensive documentation added with usage guidelines and token relationships
- ✅ Backward compatibility maintained for existing component classes
- ✅ Fixed all About page components with hardcoded navy/gold colors
- ✅ Complete visual consistency achieved across all sections using design tokens
- ✅ Fixed AboutHeroSection spacing to use proper min-h-screen centering like main hero

### File List
**Modified Files:**
- `/src/app/globals.css` - Complete design token system implementation
- `/src/components/AboutHeroSection.tsx` - Updated hardcoded colors to use design tokens
- `/src/components/ValuesImpactSection.tsx` - Replaced navy/gold with royal blue tokens
- `/src/components/EnhancedMissionSection.tsx` - Updated all color values to use design tokens
- `/src/components/LeadershipOverviewSection.tsx` - Fixed hardcoded colors throughout
- `/src/components/HeritageSection.tsx` - Updated color scheme to royal blue system

### Debug Log References
No debug entries required - implementation completed successfully without issues.